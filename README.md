# Vocabulary Helper

一个只靠浏览器、没有后端、关闭标签页也不丢进度的「背词 + 定时复习 + 键盘丝滑切换」小工具。主打：快、轻、可读、可继续。

## 🥪 这是什么（电梯版）
你加载一个词库 → 右箭头一路刷词 → 系统自动：
1. 按 5 分钟时间块回收你刚见过的词做快速复习；
2. 满 30 分钟再来一场“本场所有词”的整合复习；
3. 收尾自动排 2 天 / 7 天的复习计划；
4. 下次打开直接把到期的词塞到最前面；
5. 所有状态都在 `localStorage`，无网络也能继续。

## 🤹 如何使用（不看文档也能会的那种）
1. 打开开发/部署页面（见下面“启动”）。
2. 右方向键：下一个。左方向键：上一个。下方向键：再念一遍。上方向键：我不想看它（跳过+小飞天）。
3. 看着背景颜色慢慢“升级”即可：
   - 白色：第一次见；
   - 浅青：已进入 5 分钟块复习；
   - 浅绿：进入整场 30 分钟复习大名单；
   - 深一点的绿：来自 2 天后的回归；
4. 右箭头冲刺到 30 分钟后，会话清空 → 计划 2d / 7d 复习自动写入；刷新也不会丢。
5. 换词库：顶部下拉选择，当前会话重置，但未来的计划复习列表仍保留（不同词库独立）。

## ⌨️ 键盘快捷键一览
| 键 | 作用 |
|----|------|
| → | 下一个（自动发音） |
| ← | 上一个（历史，不会错乱） |
| ↓ | 重放当前词发音（含例句） |
| ↑ | 跳过当前词（动画 + 永不再出现 + 清理未来计划） |
| S / s | 手动再播一遍（和 ↓ 相同） |

## 🎨 阶段 / 颜色语义
| 阶段 | 触发时机 | 背景色 | 说明 |
|------|----------|--------|------|
| new | 初次浏览 | 白色 | 还没进入任何复习块 |
| block | 某词出现在已结束的 5 分钟时间块内 | 浅青 (#e6fffb) | 快速回顾，局部强化 |
| session | 满 30 分钟总体复习加入 | 浅绿 (#e8f8e6) | 当场所有已见词统一巩固 |
| due2d | 来自 2 天后的计划复习 | 稍深绿 (#c6efc6) | 跨日间隔记忆巩固 |

跳过 (↑) 时临时加深为更深绿（视觉告别），并永久标记为忽略，后续任何阶段都不再出现。

## 🧠 调度与时间线（核心逻辑）
时间单位只统计“页面可见”秒数：浏览器标签页不激活 → 暂停计时。

1. 5 分钟块：结束一个块时，把该块新出现的所有词（去重）加入 `reviewQueue`，并把它们的阶段从 `new` 升到 `block`。
2. 30 分钟整场：时间 ≥ 30 分钟时，把“本场所有已见词”打包（去重、过滤已跳过）加入复习队列，阶段升到 `session`。
3. 会话结束：当（30 分钟已触发）且所有队列清空 → 为“本场已见词”排 2d 与 7d 复习计划（持久化）。
4. 进入下一次：初始化时把到期的计划（<= 当前时间）拉入 `dueNow` 队列；2 天计划的词标记阶段为 `due2d` 再展示。
5. 跳过策略：立即从所有当前/未来结构中移除（包括已排计划），并记录到 `skippedIds`，后续任何复习生成都过滤。

这样保证：2 天的回归一定发生在“至少经历过整场 30 分钟复习之后”。

## 🧾 数据结构概览
`src/types.ts` 中核心 `Word`：
```ts
export type Word = { id: string; term: string; phonetic?: string; audio?: string; meaning: string; examples?: string[] }
```
队列：
- `newQueue`：未见过的。
- `reviewQueue`：5 分钟块或整场加入。
- `dueNow`：来自计划（2d / 7d）的到期词。

其它：
- `seen`：{ wordId, seenAtSec } 列表，支持时间窗口回溯。
- `scheduled`：未来 `{ wordId, dueAt, reason }`（reason=2d|7d）。
- `wordStage`：阶段映射，驱动背景色。
- `skippedIds`：跳过屏蔽集合。

## 🔊 发音系统
- 使用浏览器 Speech Synthesis；进入新词自动播，向前回退不自动播。
- 每次按 → 会先取消上一个未完成的语音，避免堆积。
- 预加载：提前构造接下来 3 个单词的 utterance，减少延迟。
- ↓ / S 手动重播；例句存在时追加朗读。

## 🧽 文本换行修复
原始词库里有字面量 `\n`。加载时通过 `normalizeText()` 统一：CRLF→LF，并把字面 `\n` 变成真实换行；渲染时按 `\n` 分段 `<p>`。详见 `debug.md`。

## 🏗 技术路线
- Vue 3 + `<script setup>` + TypeScript。
- Pinia 管理 session（时间、阶段、调度、跳过、计划复习）。
- Vite 动态 `?url` 引入大 JSON，避免打包体积暴涨。
- 纯前端持久化：`localStorage`（状态 + 计划复习）。
- 动画：方向感知滑动、跳过上飞、阶段色渐进。
- 语音：浏览器内置 Speech Synthesis + 简单缓存。

## 🚀 启动 & 构建
```powershell
npm install
npm run dev   # 本地开发
npm run build # 生产构建
npm run preview
```
打开终端提示的本地地址即可。

## 🗃 词库加载与映射
IELTS 原始字段：`word / phonetic / translation / definition / example` → 统一映射为 `Word`。
规则：translation 优先，没有则用 definition；example 按换行拆成数组；`id = term#index` 保证稳定。
新增词库：放 JSON 于 `src/data`，在 `libraries.ts` 增加元数据 + 映射函数即可。

## 🐾 开发阅读指引
| 文件 | 用途 |
|------|------|
| `src/stores/session.ts` | 所有进度 / 计时 / 复习调度 / 阶段逻辑 | 
| `src/data/libraries.ts` | 词库元数据、加载、文本规范化 | 
| `src/components/WordCard.vue` | 展示 + 阶段色 + 发音按钮 | 
| `src/utils/speech.ts` | 语音封装 / 预加载 | 
| `src/App.vue` | 布局、键盘事件、过渡动画、设置面板 | 

## 🧪 快速自检清单
1. 连按 → 是否顺畅且自动发音。
2. 5 分钟后（可临时改 `blockSizeSec` 方便测试）是否出现复习回收。
3. 30 分钟阈值（同理可改 `totalSessionSec`）后是否触发整场复习与阶段变色。
4. 结束后刷新：到期 2 天计划（可通过修改系统时间或调小间隔测试）是否进入 `dueNow` 并显示深绿。
5. 跳过的词是否再也不出现。

## 🧭 未来可能的增强
- 自定义时间参数 UI（5m / 30m 可调）。
- 搜索 / 过滤 / 标星 / 生词本。
- IndexedDB 存更大数据 + 增量更新。
- 导出 / 导入进度。
- PWA / 离线安装。

## ⚖️ License
（按需要补充）

---
Have fun & Keep shipping memory into long-term storage 🚀

